# ä¸“ä¸šå…­çˆ»æ’ç›˜ä¸APIæœåŠ¡

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å…­çˆ»æ’ç›˜å·¥å…·ï¼Œæä¾›å®Œæ•´çš„å…­çˆ»èµ·å¦ã€æ’ç›˜å’Œåˆ†æåŠŸèƒ½ã€‚æ”¯æŒå¤šç§èµ·å¦æ–¹å¼ï¼ŒåŒ…å«å®Œæ•´çš„çº³ç”²ã€å…­äº²ã€å…­ç¥ã€ä¸–åº”ç­‰ä¼ ç»Ÿå…­çˆ»è¦ç´ ï¼ŒåŒæ—¶æä¾›Webç•Œé¢å’ŒAPIæ¥å£ä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚

## ğŸŒŸ é¡¹ç›®ç‰¹ç‚¹

### æ ¸å¿ƒåŠŸèƒ½
- **å®Œæ•´çš„å…­çˆ»æ’ç›˜ç³»ç»Ÿ**: æ”¯æŒæ—¶é—´èµ·å¦ã€æ‰‹å·¥æŒ‡å®šã€å¦åèµ·å¦ä¸‰ç§æ–¹å¼
- **ä¼ ç»Ÿå…­çˆ»è¦ç´ **: å®Œæ•´æ”¯æŒçº³ç”²ã€å…­äº²ã€å…­ç¥ã€ä¸–åº”æ ‡è®°
- **ç²¾ç¡®çš„æ—¶é—´è½¬æ¢**: å…¬å†å†œå†è½¬æ¢ã€å¤©å¹²åœ°æ”¯è®¡ç®—
- **ä¸“ä¸šçš„å¦è±¡åˆ†æ**: æœ¬å¦å˜å¦å¯¹æ¯”ã€åŠ¨çˆ»æ ‡è®°

### æ¥å£æ–¹å¼
- **Webç”¨æˆ·ç•Œé¢**: åŸºäºStreamlitæ„å»ºçš„ç›´è§‚ç•Œé¢ï¼Œæ”¯æŒå®æ—¶æ’ç›˜å’Œç»“æœå±•ç¤º
- **RESTful API**: åŸºäºFastAPIæ„å»ºï¼Œæä¾›å®Œæ•´çš„ç¼–ç¨‹æ¥å£
- **å®¢æˆ·ç«¯ç¤ºä¾‹**: æä¾›Pythonå®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç 

### æŠ€æœ¯ç‰¹è‰²
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **APIè®¤è¯**: ä½¿ç”¨API Keyè¿›è¡Œå®‰å…¨è®¤è¯
- **å®æ—¶é‡è½½**: å¼€å‘æ¨¡å¼æ”¯æŒä»£ç çƒ­é‡è½½
- **å®Œæ•´æ–‡æ¡£**: è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- pip åŒ…ç®¡ç†å™¨

### å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### å¯åŠ¨æœåŠ¡
```bash
# æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ (Windows)
start_services.bat

# æ–¹æ³•2: ä½¿ç”¨å¯åŠ¨è„šæœ¬ (Linux/Mac)
./start_services.sh

# æ–¹æ³•3: æ‰‹åŠ¨å¯åŠ¨
# å¯åŠ¨APIæœåŠ¡ (ç«¯å£8001)
cd app && uvicorn main:app --reload --port 8001

# å¯åŠ¨Webç•Œé¢ (ç«¯å£8503)
streamlit run webui_api.py --server.port 8503
```

### è®¿é—®æœåŠ¡
- **Webç•Œé¢**: http://localhost:8503
- **APIæ–‡æ¡£**: http://localhost:8001/docs
- **APIæ¥å£**: http://localhost:8001

## ğŸ“š APIä½¿ç”¨æŒ‡å—

### è®¤è¯æ–¹å¼
æ‰€æœ‰APIè¯·æ±‚éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«API Keyï¼š
```
Authorization: Bearer your-secret-api-key
```

### ç”ŸæˆAPI Key
```bash
python create_api_key.py
```

### APIç«¯ç‚¹

#### 1. å¢å¼ºå‹å…­çˆ»æ’ç›˜ (æ¨è)
**ç«¯ç‚¹**: `POST /enhanced-divination`

æ”¯æŒä¸‰ç§èµ·å¦æ–¹å¼ï¼š

**æ—¶é—´èµ·å¦** (åŸºäºå½“å‰æ—¶é—´)
```json
{
  "divination_type": "time"
}
```

**æ‰‹å·¥æŒ‡å®š** (æ‰‹åŠ¨æŒ‡å®šå…­çˆ»)
```json
{
  "divination_type": "manual",
  "manual_yaos": ["é˜³çˆ»", "é˜´çˆ»åŠ¨", "é˜³çˆ»", "é˜´çˆ»", "é˜³çˆ»åŠ¨", "é˜´çˆ»"],
  "target_time": "2024-01-01T10:30:00"
}
```

**å¦åèµ·å¦** (åŸºäºå¦å)
```json
{
  "divination_type": "name",
  "upper_original": "ä¹¾",
  "lower_original": "å¤",
  "upper_changed": "éœ‡",
  "lower_changed": "å·½",
  "target_time": "2024-01-01T10:30:00"
}
```

#### 2. åŸºç¡€å…­çˆ»æ’ç›˜
**ç«¯ç‚¹**: `POST /divination`
```json
{
  "target_time": "2024-01-01T10:30:00"  // å¯é€‰ï¼Œé»˜è®¤å½“å‰æ—¶é—´
}
```

### å“åº”æ ¼å¼
```json
{
  "divination_type": "æ—¶é—´èµ·å¦",
  "query_time": {
    "formatted_time": "2024-01-01 10:30:00",
    "lunar_date": "2023å¹´åä¸€æœˆäºŒåæ—¥ å·³æ—¶",
    "ganzhi_info": {
      "year_gz": "ç™¸å¯",
      "month_gz": "ç”²å­",
      "day_gz": "ä¸å·³",
      "hour_gz": "ä¹™å·³"
    }
  },
  "hexagram": {
    "original": {
      "name": "å¤©åœ°å¦",
      "upper_trigram": "ä¹¾",
      "lower_trigram": "å¤",
      "yao_binary": "111000",
      "gong": "ä¹¾å®«",
      "yaos": [
        {
          "position": 1,
          "binary": "0",
          "type": "é˜´çˆ»",
          "liuqin": "å¦»è´¢",
          "najia": "æœªåœŸ",
          "liushen": "é’é¾™",
          "shi_ying": "ä¸–"
        }
        // ... å…¶ä»–çˆ»ä½ä¿¡æ¯
      ]
    },
    "changed": {
      // å˜å¦ä¿¡æ¯ç»“æ„åŒä¸Š
    },
    "moving_line": 3  // åŠ¨çˆ»ä½ç½®
  }
}
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
liuyao/
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–åŒ…
â”œâ”€â”€ start_services.bat         # Windowså¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_services.sh          # Linux/Macå¯åŠ¨è„šæœ¬
â”œâ”€â”€ create_api_key.py          # API Keyç”Ÿæˆå·¥å…·
â”œâ”€â”€ liuyao_api.db             # SQLiteæ•°æ®åº“
â”œâ”€â”€ app/                       # FastAPIåº”ç”¨
â”‚   â”œâ”€â”€ main.py               # APIä¸»å…¥å£
â”‚   â”œâ”€â”€ schemas.py            # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ crud.py              # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ dependencies.py      # APIä¾èµ–é¡¹
â”‚   â”œâ”€â”€ models.py            # SQLAlchemyæ¨¡å‹
â”‚   â””â”€â”€ services/            # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚       â”œâ”€â”€ constants.py     # å…­çˆ»å¸¸é‡å®šä¹‰
â”‚       â”œâ”€â”€ time_converter.py # æ—¶é—´è½¬æ¢æœåŠ¡
â”‚       â”œâ”€â”€ calculator.py    # å¦è±¡è®¡ç®—å™¨
â”‚       â”œâ”€â”€ divination_service.py # åŸºç¡€æ’ç›˜æœåŠ¡
â”‚       â”œâ”€â”€ enhanced_divination_service.py # å¢å¼ºæ’ç›˜æœåŠ¡
â”‚       â””â”€â”€ formatter.py     # ç»“æœæ ¼å¼åŒ–
â”œâ”€â”€ examples/                  # å®¢æˆ·ç«¯ç¤ºä¾‹
â”‚   â”œâ”€â”€ api_client_examples.py # åŸºç¡€APIç¤ºä¾‹
â”‚   â””â”€â”€ enhanced_api_client_examples.py # å¢å¼ºAPIç¤ºä¾‹
â”œâ”€â”€ webui.py                  # ç›´æ¥è°ƒç”¨çš„Webç•Œé¢
â””â”€â”€ webui_api.py             # åŸºäºAPIçš„Webç•Œé¢
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### æ—¶é—´è½¬æ¢ (`time_converter.py`)
- å…¬å†å†œå†è½¬æ¢
- å¤©å¹²åœ°æ”¯è®¡ç®—
- æ—¶è¾°è½¬æ¢

#### å¦è±¡è®¡ç®— (`calculator.py`)
- å…­çˆ»èµ·å¦ç®—æ³•
- åŠ¨çˆ»è®¡ç®—
- å˜å¦ç”Ÿæˆ

#### æ’ç›˜æœåŠ¡ (`enhanced_divination_service.py`)
- çº³ç”²é…ç½®
- å…­äº²å…³ç³»
- å…­ç¥æ’åˆ—
- ä¸–åº”æ ‡è®°

### å®¢æˆ·ç«¯ç¤ºä¾‹
é¡¹ç›®æä¾›äº†å®Œæ•´çš„Pythonå®¢æˆ·ç«¯ç¤ºä¾‹ï¼š

```python
from examples.enhanced_api_client_examples import LiuyaoAPIClient

# åˆ›å»ºå®¢æˆ·ç«¯
client = LiuyaoAPIClient()

# æ—¶é—´èµ·å¦
result = client.time_divination()

# æ‰‹å·¥æŒ‡å®š
result = client.manual_divination(["é˜³çˆ»", "é˜´çˆ»åŠ¨", "é˜³çˆ»", "é˜´çˆ»", "é˜³çˆ»", "é˜´çˆ»"])

# å¦åèµ·å¦
result = client.name_divination("ä¹¾", "å¤", "éœ‡", "å·½")
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI
- **Webç•Œé¢**: Streamlit
- **æ•°æ®åº“**: SQLite
- **æ—¶é—´å¤„ç†**: lunar_python
- **APIæ–‡æ¡£**: Swagger/OpenAPI
- **è®¤è¯**: Bearer Token

## ğŸ“ˆ åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°åŠŸèƒ½
- âœ… ä¸‰ç§èµ·å¦æ–¹å¼ï¼ˆæ—¶é—´ã€æ‰‹å·¥ã€å¦åï¼‰
- âœ… å®Œæ•´çš„å…­çˆ»è¦ç´ ï¼ˆçº³ç”²ã€å…­äº²ã€å…­ç¥ã€ä¸–åº”ï¼‰
- âœ… æœ¬å¦å˜å¦å¯¹æ¯”
- âœ… åŠ¨çˆ»æ ‡è®°
- âœ… Webç•Œé¢å’ŒAPIæ¥å£
- âœ… APIè®¤è¯å’Œæ–‡æ¡£
- âœ… å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç 

### è®¡åˆ’åŠŸèƒ½
- ğŸ”„ å¦è¾çˆ»è¾è§£é‡Š
- ğŸ”„ å…­çˆ»åˆ†æç®—æ³•
- ğŸ”„ å†å²è®°å½•åŠŸèƒ½
- ğŸ”„ æ‰¹é‡æ’ç›˜æ¥å£
- ğŸ”„ æ›´å¤šèµ·å¦æ–¹å¼

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

### å¼€å‘ç¯å¢ƒè®¾ç½®
1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/new-feature`
3. æäº¤æ›´æ”¹: `git commit -am 'Add new feature'`
4. æ¨é€åˆ†æ”¯: `git push origin feature/new-feature`
5. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤GitHub Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œå…­çˆ»é¢„æµ‹ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä»»ä½•å†³ç­–å»ºè®®ã€‚
