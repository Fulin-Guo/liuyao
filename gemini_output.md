# 六爻装卦与纳甲过程详解及Python实现

## I. 六爻预测与装卦概览

### A. 六爻预测法简述

六爻预测法，作为《易经》占筮学的一个重要分支，在中国传统预测体系中占有举足轻重的地位。它亦被称为“纳甲信息预测法”或“火珠林法” ^1^。此方法的核心在于为《易经》卦象中的各个组成部分（主要是爻）赋予五行属性，并结合时间（如年、月、日）与空间的因素，通过分析五行之间的生克制化、冲合扶拱等复杂关系，来推断事物的发展趋势和具体细节 。

六爻预测法以其预测事物的细致性、缜密性、周延性和具体性著称，信息规划性强，其预测模式呈现出一定的“公式化”特征，随意性较小，因此被认为相对容易掌握 ^1^。这种“公式化”或规则化的特性，并非意味着其简单或机械，而是指其拥有一套严谨的逻辑框架和操作步骤。正是这种系统化的规则，使得六爻预测不仅能够被深入研究和传承，也为其在现代通过计算方法进行建模和实现提供了可能性，这与用户提出的通过Python代码实现其过程的需求不谋而合。该方法认为，通过对卦爻符号体系的精确配置，可以揭示特定时空背景下事物演变的内在规律。

### B. 装卦与纳甲的重要性

在六爻预测的实际操作中，“装卦”（亦称“安卦”）是获取卦象后至关重要的第一步。它指的是将一个通过摇钱、蓍草或其他方式得到的原始卦象，配上各种必要的预测元素和符号信息的过程 ^2^。这些元素包括天干、地支、五行、六亲、六神（六兽）、世爻、应爻等。只有完成了装卦，一个原始的六爻卦象才能转化为一个包含丰富多维信息，可供分析和解读的完整预测模型。对于初学者而言，完整且正确地装卦可能颇具挑战性，需要记忆大量规则 ^2^。

“纳甲”是装卦过程中的核心环节之一。它特指将天干和地支按照特定规则纳入（或分配给）八卦乃至六十四卦的各个爻中 ^4^。“纳辰”（纳入地支）因其在实际五行分析中的直接应用，有时也代指纳甲的整个过程或其重要部分 ^4^。

装卦并非一个单一的步骤，而是一个层层递进、构建信息的过程。纳甲是其中的基础层面，它为卦爻赋予了初步的干支和五行属性。在此基础上，才能进一步确定卦宫、安世应、定六亲（六亲的确定依赖于爻的五行与卦宫五行的关系 ^5^）、安六神（六神的排布与起卦日的天干相关 ^6^）等。这种信息的层级构建关系，不仅是理解六爻装卦逻辑的关键，也是后续进行计算机编程实现时必须遵循的顺序。

## II. 手动装卦步骤详解

进行六爻预测，首先需要通过一定的方法得到一个本卦，并记录相关的起卦时间信息，然后按照既定规则逐步为卦爻装配各种元素。

### A. 获取本卦与确定动爻

获取本卦的常用方法是“三钱法”，即用三枚铜钱（古币或现代硬币均可，需区分正反面）摇掷六次，每次记录结果，从而得到从下往上（从初爻到上爻）的六个爻。通常规定：

* 三背（或三字）：为老阳，记作“O”或数字9，是动爻，阳极变阴。
* 三面（或三花）：为老阴，记作“X”或数字6，是动爻，阴极变阳。
* 两背一面：为少阳，记作“—”，数字7，是静爻，不变。
* 两面一背：为少阴，记作“--”，数字8，是静爻，不变。

记录下每一爻的阴阳属性（老阳为阳，老阴为阴，少阳为阳，少阴为阴）构成“本卦”（或称“主卦”）。同时，记下哪些爻是老阳或老阴，这些即为“动爻”。动爻在后续分析中非常重要，它们会变化成相反的爻，从而形成“变卦”（或称“之卦”）。

### B. 记录重要时间数据

在起卦的同时，必须准确记录当时的年、月、日、时的干支，以及当日的旬空地支。这些时间信息是六爻预测分析的重要参数 ^2^。

* **太岁 (Tai Sui):** 即起卦当年的年干支。
* **月建 (Yue Jian):** 即起卦当月的月干支。
* **日辰 (Ri Chen):** 即起卦当日的日干支。
* **旬空 (Xun Kong):** 根据日干支，查出当日所属甲旬的空亡地支。

这些时间因素并非仅仅作为时间的标记，它们在六爻分析中扮演着积极的角色，深刻影响着卦中五行的旺衰强弱。例如，“月破”指卦中某爻的地支被月建地支所冲，通常意味着该爻力量受损；而“旺相休囚死”则描述了五行在特定月份（由月建决定）的强弱状态 ^2^。日干支中的日干，对于排布六神至关重要。这种时间与卦象的动态互动，是六爻预测的核心机制之一。

### C. 运用八宫系统确定卦宫

六十四卦并非杂乱无章，而是可以通过“八宫”系统进行归类。该系统相传为西汉京房所创立 ^7^，它将六十四卦分为八个“宫”，每宫由一个纯卦（即八经卦：乾、坤、震、巽、坎、离、艮、兑）作为宫主，统领其余七个由其演变而来的卦。

每宫内卦的排列顺序遵循特定的爻变规律 ^8^：

1. **本宫卦 (纯卦):** 如乾为天。
2. **一世卦:** 本宫卦初爻变（最下面的爻改变阴阳）。如乾宫一世卦为天风姤。
3. **二世卦:** 一世卦二爻变。如乾宫二世卦为天山遁。
4. **三世卦:** 二世卦三爻变。如乾宫三世卦为天地否。
5. **四世卦:** 三世卦四爻变。如乾宫四世卦为风地观。
6. **五世卦:** 四世卦五爻变。如乾宫五世卦为山地剥。
7. **游魂卦:** 五世卦的第四爻再变（注意，不是第六爻变，而是五世卦基础上第四爻变）。如乾宫游魂卦为火地晋 ^8^。
8. **归魂卦:** 游魂卦的内卦（下三爻）全部变成与本宫卦的内卦相同。如乾宫归魂卦为火天大有 ^8^。

一个卦属于哪个宫，决定了该卦的“卦宫五行”，这对于后续安六亲至关重要。例如，乾宫属金，则乾宫内的所有八个卦（乾、姤、遁、否、观、剥、晋、大有）的卦宫五行皆为金。这种爻变的生成顺序具有明确的算法性质，京房的理论详细描述了这种有序的爻变过程 ^8^，这为计算机程序化确定卦宫及其在宫内次第（世卦类型）提供了基础。

**表1: 八宫卦世序（以乾宫和坤宫为例）**

| **宫位** | **卦宫五行** | **世序** | **卦名（上/下）** | **卦象（二进制表示，下爻为第0位）** |
| -------------- | ------------------ | -------------- | ----------------------- | ----------------------------------------- |
| 乾宫           | 金                 | 八纯（六世）   | 乾为天 (乾/乾)          | 111111                                    |
|                |                    | 一世           | 天风姤 (乾/巽)          | 011111                                    |
|                |                    | 二世           | 天山遁 (乾/艮)          | 101111                                    |
|                |                    | 三世           | 天地否 (乾/坤)          | 000111                                    |
|                |                    | 四世           | 风地观 (巽/坤)          | 000110                                    |
|                |                    | 五世           | 山地剥 (艮/坤)          | 000100                                    |
|                |                    | 游魂           | 火地晋 (离/坤)          | 000101                                    |
|                |                    | 归魂           | 火天大有 (离/乾)        | 111101                                    |
| 坤宫           | 土                 | 八纯（六世）   | 坤为地 (坤/坤)          | 000000                                    |
|                |                    | 一世           | 地雷复 (坤/震)          | 100000                                    |
|                |                    | 二世           | 地泽临 (坤/兑)          | 010000                                    |
|                |                    | 三世           | 地天泰 (坤/乾)          | 111000                                    |
|                |                    | 四世           | 雷天大壮 (震/乾)        | 111001                                    |
|                |                    | 五世           | 泽天夬 (兑/乾)          | 111011                                    |
|                |                    | 游魂           | 水天需 (坎/乾)          | 111010                                    |
|                |                    | 归魂           | 水地比 (坎/坤)          | 000010                                    |

*(注：其他各宫以此类推。二进制表示中，1为阳爻，0为阴爻。)*

### D. 纳甲系统：配天干地支

纳甲是将天干和地支分配给卦爻的过程。

**1. 天干地支基础与五行对应**

* **十天干:** 甲 (jiǎ)、乙 (yǐ)、丙 (bǐng)、丁 (dīng)、戊 (wù)、己 (jǐ)、庚 (gēng)、辛 (xīn)、壬 (rén)、癸 (guǐ) ^12^。
* **十二地支:** 子 (zǐ)、丑 (chǒu)、寅 (yín)、卯 (mǎo)、辰 (chén)、巳 (sì)、午 (wǔ)、未 (wèi)、申 (shēn)、酉 (yǒu)、戌 (xū)、亥 (hài) ^12^。

它们各自具有阴阳和五行属性，这在六爻分析中至关重要 ^6^。

**表2: 天干地支及其属性**

| **名称** | **拼音** | **阴阳** | **五行** |
| -------------- | -------------- | -------------- | -------------- |
| 甲             | jiǎ           | 阳             | 木             |
| 乙             | yǐ            | 阴             | 木             |
| 丙             | bǐng          | 阳             | 火             |
| 丁             | dīng          | 阴             | 火             |
| 戊             | wù            | 阳             | 土             |
| 己             | jǐ            | 阴             | 土             |
| 庚             | gēng          | 阳             | 金             |
| 辛             | xīn           | 阴             | 金             |
| 壬             | rén           | 阳             | 水             |
| 癸             | guǐ           | 阴             | 水             |
| 子             | zǐ            | 阳             | 水             |
| 丑             | chǒu          | 阴             | 土             |
| 寅             | yín           | 阳             | 木             |
| 卯             | mǎo           | 阴             | 木             |
| 辰             | chén          | 阳             | 土             |
| 巳             | sì            | 阴             | 火             |
| 午             | wǔ            | 阳             | 火             |
| 未             | wèi           | 阴             | 土             |
| 申             | shēn          | 阳             | 金             |
| 酉             | yǒu           | 阴             | 金             |
| 戌             | xū            | 阳             | 土             |
| 亥             | hài           | 阴             | 水             |

*(五行对应参考 ^6^)*

**2. 八纯卦纳甲规则**

八纯卦的纳甲是整个纳甲系统的基础。其总原则是：阳卦（乾、震、坎、艮）纳阳干阳支，地支顺行；阴卦（坤、巽、离、兑）纳阴干阴支，地支逆行 ^4^。

具体的纳干支规则，尤其是各地支的起始点和内外卦的干有所不同，历代有所演化，但京房易的纳甲体系较为通行。根据《事林广记》所载纳甲要法及各爻分配 ^6^ 并参照其他文献 ^4^：

* **乾卦 (☰):** 内卦（下三爻）初爻起甲子，顺布子、寅、辰；外卦（上三爻）四爻起壬午，顺布午、申、戌。
  * 爻位 (由下至上): 初爻 甲子, 二爻 甲寅, 三爻 甲辰, 四爻 壬午, 五爻 壬申, 上爻 壬戌。
* **坤卦 (☷):** 内卦初爻起乙未，逆布未、巳、卯；外卦四爻起癸丑，逆布丑、亥、酉。
  * 爻位: 初爻 乙未, 二爻 乙巳, 三爻 乙卯, 四爻 癸丑, 五爻 癸亥, 上爻 癸酉。
* **震卦 (☳):** （长男，从父，类乾）内外卦皆纳庚，初爻起庚子，顺布子、寅、辰、午、申、戌。
  * 爻位: 初爻 庚子, 二爻 庚寅, 三爻 庚辰, 四爻 庚午, 五爻 庚申, 上爻 庚戌。
* **巽卦 (☴):** （长女，从母，类坤）内外卦皆纳辛，初爻起辛丑，逆布丑、亥、酉、未、巳、卯。
  * 爻位: 初爻 辛丑, 二爻 辛亥, 三爻 辛酉, 四爻 辛未, 五爻 辛巳, 上爻 辛卯。
* **坎卦 (☵):** （中男，从父，类乾）内外卦皆纳戊，初爻起戊寅，顺布寅、辰、午、申、戌、子。
  * 爻位: 初爻 戊寅, 二爻 戊辰, 三爻 戊午, 四爻 戊申, 五爻 戊戌, 上爻 戊子。
* **离卦 (☲):** （中女，从母，类坤）内外卦皆纳己，初爻起己卯，逆布卯、丑、亥、酉、未、巳。
  * 爻位: 初爻 己卯, 二爻 己丑, 三爻 己亥, 四爻 己酉, 五爻 己未, 上爻 己巳。
* **艮卦 (☶):** （少男，从父，类乾）内外卦皆纳丙，初爻起丙辰，顺布辰、午、申、戌、子、寅。
  * 爻位: 初爻 丙辰, 二爻 丙午, 三爻 丙申, 四爻 丙戌, 五爻 丙子, 上爻 丙寅。
* **兑卦 (☱):** （少女，从母，类坤）内外卦皆纳丁，初爻起丁巳，逆布巳、卯、丑、亥、酉、未。
  * 爻位: 初爻 丁巳, 二爻 丁卯, 三爻 丁丑, 四爻 丁亥, 五爻 丁酉, 上爻 丁未。

**表3: 八纯卦纳甲总览**

| **纯卦** | **内卦天干** | **外卦天干** | **初爻地支** | **爻支顺序 (由初至上)** |
| -------------- | ------------------ | ------------------ | ------------------ | ----------------------------- |
| 乾             | 甲                 | 壬                 | 子 (阳顺)          | 子、寅、辰、午、申、戌        |
| 坤             | 乙                 | 癸                 | 未 (阴逆)          | 未、巳、卯、丑、亥、酉        |
| 震             | 庚                 | 庚                 | 子 (阳顺)          | 子、寅、辰、午、申、戌        |
| 巽             | 辛                 | 辛                 | 丑 (阴逆)          | 丑、亥、酉、未、巳、卯        |
| 坎             | 戊                 | 戊                 | 寅 (阳顺)          | 寅、辰、午、申、戌、子        |
| 离             | 己                 | 己                 | 卯 (阴逆)          | 卯、丑、亥、酉、未、巳        |
| 艮             | 丙                 | 丙                 | 辰 (阳顺)          | 辰、午、申、戌、子、寅        |
| 兑             | 丁                 | 丁                 | 巳 (阴逆)          | 巳、卯、丑、亥、酉、未        |

在纳甲体系中，地支（辰）因其直接关联五行，在爻的分析中被广泛运用，而天干（干）的作用则更为根本性或结构性。有观点认为，传统卜筮家“舍干用支”可能未尽纳甲之全意，因“卦为体，爻为用，干为主，辰为客”，重客轻主似有失偏颇 ^4^。然而，在六亲的实际排定中，正是爻所纳地支的五行属性与卦宫五行发生作用。天干则在其他层面发挥作用，如日干决定六神，而八卦所纳之干（如乾纳甲壬）则体现了卦的根本性质。这种干支在应用层面上的侧重不同，也反映了该体系内部的复杂性和多层次含义。

**3. 应用纳甲于六十四卦的内外卦**

任何一个六十四卦都由一个内卦（下三爻）和一个外卦（上三爻）组成 ^15^。该卦的纳甲，即是将组成它的内卦和外卦，分别按照其对应的纯卦的纳甲规则来安上干支。例如，泰卦 (地天泰，坤上乾下)，其内卦为乾，外卦为坤。因此，泰卦的初、二、三爻（内卦）按照乾卦内卦的纳甲（甲子、甲寅、甲辰）来安，四、五、上爻（外卦）按照坤卦外卦的纳甲（癸丑、癸亥、癸酉）来安 ^4^。

### E. 定世爻与应爻

世爻代表问卦之人或事物本身，应爻代表所问之事或对方。它们在卦中的位置是固定的，由该卦在其所属八宫的“世序”（即第几世卦）决定 ^6^。

根据《事林广记》等文献的规则 ^6^：

* **八纯卦 (本宫卦):** 世爻在上爻 (六爻)。
* **一世卦:** 世爻在初爻。
* **二世卦:** 世爻在二爻。
* **三世卦:** 世爻在三爻。
* **四世卦:** 世爻在四爻。
* **五世卦:** 世爻在五爻。
* **游魂卦:** 世爻在四爻。
* **归魂卦:** 世爻在三爻。

应爻的位置总是与世爻相隔两位（即世爻爻位加3或减3，循环计算）。例如，世在初，则应在四；世在二，则应在五；世在上（六），则应在三。

**表4: 世爻与应爻位置规则**

| **卦的世序** | **世爻位置** | **应爻位置** |
| ------------------ | ------------------ | ------------------ |
| 八纯卦（如乾、坤） | 上爻               | 三爻               |
| 一世卦             | 初爻               | 四爻               |
| 二世卦             | 二爻               | 五爻               |
| 三世卦             | 三爻               | 上爻               |
| 四世卦             | 四爻               | 初爻               |
| 五世卦             | 五爻               | 二爻               |
| 游魂卦             | 四爻               | 初爻               |
| 归魂卦             | 三爻               | 上爻               |

### F. 安六亲

六亲（父母、兄弟、子孙、妻财、官鬼）是代表与所问之事相关的各种人事、因素或状态的符号。它们被分配给卦中的每一爻，依据是该爻地支的五行与卦宫五行的生克关系 ^5^。

其对应关系如下（以“我”代表卦宫五行） ^6^：

* **生我者为父母 (Parents):** 生助卦宫五行的爻。
* **同我者为兄弟 (Siblings):** 与卦宫五行相同的爻。
* **我生者为子孙 (Offspring):** 被卦宫五行所生的爻。
* **我克者为妻财 (Wealth):** 被卦宫五行所克的爻。
* **克我者为官鬼 (Officials):** 克制卦宫五行的爻。

**表5: 六亲确定规则 (基于爻五行与卦宫五行关系)**

| **爻支五行与卦宫五行关系** | **六亲** |
| -------------------------------- | -------------- |
| 生助卦宫五行 (生我)              | 父母           |
| 与卦宫五行相同 (同我)            | 兄弟           |
| 被卦宫五行所生 (我生)            | 子孙           |
| 被卦宫五行所克 (我克)            | 妻财           |
| 克制卦宫五行 (克我)              | 官鬼           |

*(五行生克关系：木生火，火生土，土生金，金生水，水生木；木克土，土克水，水克火，火克金，金克木)*

### G. 安六神 (六兽)

六神，又称六兽（青龙、朱雀、勾陈、螣蛇、白虎、玄武），为卦爻增添了另一层象征意义，常与事物的性质、状态或吉凶的特定表现相关。六神的排布是从初爻到上爻依次进行，其起始神兽由起卦当日的日干决定 ^6^。

根据《事林广记》所载规则 ^6^：

* **甲乙日:** 初爻起青龙，依次为朱雀、勾陈、螣蛇、白虎、玄武。
* **丙丁日:** 初爻起朱雀，依次为勾陈、螣蛇、白虎、玄武、青龙。
* **戊日:** 初爻起勾陈，依次为螣蛇、白虎、玄武、青龙、朱雀。
* **己日:** ^6^ 初爻起勾陈，依次为螣蛇、白虎、玄武、青龙、朱雀。
* **庚辛日:** 初爻起白虎，依次为玄武、青龙、朱雀、勾陈、螣蛇。
* **壬癸日:** 初爻起玄武，依次为青龙、朱雀、勾陈、螣蛇、白虎。

**表6: 六神排布规则 (根据日干)**

| **日干** | **初爻** | **二爻** | **三爻** | **四爻** | **五爻** | **上爻** |
| -------------- | -------------- | -------------- | -------------- | -------------- | -------------- | -------------- |
| 甲、乙         | 青龙           | 朱雀           | 勾陈           | 螣蛇           | 白虎           | 玄武           |
| 丙、丁         | 朱雀           | 勾陈           | 螣蛇           | 白虎           | 玄武           | 青龙           |
| 戊             | 勾陈           | 螣蛇           | 白虎           | 玄武           | 青龙           | 朱雀           |
| 己             | 勾陈           | 螣蛇           | 白虎           | 玄武           | 青龙           | 朱雀           |
| 庚、辛         | 白虎           | 玄武           | 青龙           | 朱雀           | 勾陈           | 螣蛇           |
| 壬、癸         | 玄武           | 青龙           | 朱雀           | 勾陈           | 螣蛇           | 白虎           |

与六亲源于卦的内部结构（爻五行与宫五行）不同，六神是由外部的时间因素（日干）所赋予的。这表明每日的宇宙“气场”或特定影响会覆盖在卦象本身的信息之上，为解读增添了时效性的动态色彩。

### H. 推演变卦及其属性

如果本卦中存在动爻（老阳或老阴），这些动爻会变成其相反的爻（阳变阴，阴变阳），从而形成一个新的卦，称为“变卦”或“之卦”。变卦同样可以进行纳甲、安六亲等操作，以分析事物发展变化的趋势或最终结果 ^2^。通常分析的重点在于本卦以及动爻如何指向变卦，以及变出之爻的含义。

## III. 六爻装卦与纳甲的Python实现

将上述复杂的装卦规则通过Python代码实现，可以大大提高效率并减少人为错误。

### A. 设计思路与数据结构

1. 卦、干支及规则的表示

为了在Python中实现六爻装卦，需要合理地组织和表示各种基础数据和规则。

* **八卦 (Trigrams):** 可以用字典表示，包含名称、二进制爻象（如乾为 ``，1代表阳，0代表阴）、五行属性、以及在构成六十四卦时内外卦所纳的天干。
* **六十四卦 (Hexagrams):** 可以用一个包含六个爻（0或1）的列表或元组表示。爻的顺序通常从下往上。一个六十四卦的唯一标识可以是其六爻的二进制字符串。
* **天干地支:** 可以用列表或字典存储，并包含其五行、阴阳等属性。
* **规则库:**
  * **纳甲规则:** 核心规则，可以用字典存储，键为八纯卦名称，值为一个包含六个元组的列表，每个元组代表一爻所纳的（天干, 地支）。
  * **八宫序列:** 包含每个宫的主卦、五行、以及宫内八个卦（通常用其二进制爻象字符串作为键）的名称和“世”的类型（如本宫、一世、游魂等）。
  * **世应规则:** 字典，键为“世”的类型，值为世爻所在的爻位。
  * **六亲规则:** 字典或一组条件判断，根据爻五行与宫五行的生克关系确定六亲。
  * **六神规则:** 字典，键为日干（或日干组合），值为从初爻到上爻的六神顺序列表。

这种基于规则的系统，其装卦过程的每一步骤（如定宫、纳甲、安世应、配六亲、安六神）都具有明确的输入、处理逻辑和输出，天然适合采用模块化的编程方式。每个步骤可以封装成一个独立的Python函数。这种设计不仅使代码结构清晰、易于理解和维护，也准确地反映了传统装卦方法的有序性和逻辑性。

### B. 核心Python函数

以下是实现六爻装卦所需的核心功能模块。

1. 输入卦爻数据

需要一个函数来处理输入的卦爻信息。输入可以是六次摇钱的结果（如6, 7, 8, 9的序列），函数将其转换为本卦的六个爻（阴阳表示，如0和1）并识别出动爻的位置。

2. 确定卦宫及八宫信息

此函数接收一个六爻卦象（二进制表示），通过查阅预设的八宫数据结构（见表1的扩展），确定该卦属于哪个宫、该宫的五行属性，以及该卦是此宫的第几世卦（如本宫、一世……归魂）。

3. 实现纳甲逻辑

该函数根据输入的六爻卦象（分解为内卦和外卦），并参照表3的纳甲规则，为每一爻配上相应的天干和地支。

4. 计算世爻与应爻

依据上一部确定的卦的“世”的类型（如“三世卦”），参照表4的规则，确定世爻和应爻分别在哪一爻。

5. 分配六亲

此函数需要每一爻纳甲后的地支五行以及卦宫的五行。然后根据表5定义的五行生克关系，为每一爻安上对应的六亲。

6. 分配六神（需日干输入）

接收起卦当日的日干（如“甲”），然后根据表6的规则，从初爻到上爻依次为六个爻配上六神。

7. 生成变卦

如果本卦中有动爻，此函数将动爻变为其相反的爻，从而生成变卦的六爻组合。变卦可以作为参数再次传入上述函数以获取其完整的装卦信息。

### C. 完整Python脚本及说明

**Python**

```python
# --- 数据定义 ---
TIANGAN = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸']
DIZHI = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥']
ELEMENTS = ['木', '火', '土', '金', '水']

TIANGAN_INFO = {
    '甲': {'yin_yang': '阳', 'element': '木'}, '乙': {'yin_yang': '阴', 'element': '木'},
    '丙': {'yin_yang': '阳', 'element': '火'}, '丁': {'yin_yang': '阴', 'element': '火'},
    '戊': {'yin_yang': '阳', 'element': '土'}, '己': {'yin_yang': '阴', 'element': '土'},
    '庚': {'yin_yang': '阳', 'element': '金'}, '辛': {'yin_yang': '阴', 'element': '金'},
    '壬': {'yin_yang': '阳', 'element': '水'}, '癸': {'yin_yang': '阴', 'element': '水'},
}
DIZHI_INFO = {
    '子': {'yin_yang': '阳', 'element': '水'}, '丑': {'yin_yang': '阴', 'element': '土'},
    '寅': {'yin_yang': '阳', 'element': '木'}, '卯': {'yin_yang': '阴', 'element': '木'},
    '辰': {'yin_yang': '阳', 'element': '土'}, '巳': {'yin_yang': '阴', 'element': '火'},
    '午': {'yin_yang': '阳', 'element': '火'}, '未': {'yin_yang': '阴', 'element': '土'},
    '申': {'yin_yang': '阳', 'element': '金'}, '酉': {'yin_yang': '阴', 'element': '金'},
    '戌': {'yin_yang': '阳', 'element': '土'}, '亥': {'yin_yang': '阴', 'element': '水'},
}

# 八卦定义 (爻由下至上, 1为阳, 0为阴)
TRIGRAMS = {
    '乾': {'lines': (1, 1, 1), 'element': '金', 'char': '☰'},
    '兑': {'lines': (0, 1, 1), 'element': '金', 'char': '☱'},
    '离': {'lines': (1, 0, 1), 'element': '火', 'char': '☲'},
    '震': {'lines': (0, 0, 1), 'element': '木', 'char': '☳'},
    '巽': {'lines': (1, 1, 0), 'element': '木', 'char': '☴'},
    '坎': {'lines': (0, 1, 0), 'element': '水', 'char': '☵'},
    '艮': {'lines': (1, 0, 0), 'element': '土', 'char': '☶'},
    '坤': {'lines': (0, 0, 0), 'element': '土', 'char': '☷'},
}

# 六十四卦卦名 (部分示例，实际应完整)
# 键为6爻二进制字符串 (初爻在最右)
HEXAGRAM_NAMES = {
    "111111": "乾为天", "000000": "坤为地", "100000": "地雷复", "011111": "天风姤",
    #... 更多卦名
}

# 八宫定义 (卦的二进制表示：上卦三位 + 下卦三位，例如 乾为天 111111)
# '世序' (generation_type) 用于确定世爻
BA_GONG_PALACES = {
    '乾': {'head_trigram': '乾', 'element': '金', 'hexagrams': {
        "111111": {"name": "乾为天", "generation_type": "八纯"}, # 乾上乾下
        "011111": {"name": "天风姤", "generation_type": "一世"}, # 乾上巽下 (巽初爻0)
        "101111": {"name": "天山遁", "generation_type": "二世"}, # 乾上艮下 (艮二爻0)
        "000111": {"name": "天地否", "generation_type": "三世"}, # 乾上坤下 (坤三爻0)
        "000110": {"name": "风地观", "generation_type": "四世"}, # 巽上坤下
        "000100": {"name": "山地剥", "generation_type": "五世"}, # 艮上坤下
        "000101": {"name": "火地晋", "generation_type": "游魂"}, # 离上坤下
        "111101": {"name": "火天大有", "generation_type": "归魂"}  # 离上乾下
    }},
    '坤': {'head_trigram': '坤', 'element': '土', 'hexagrams': {
        "000000": {"name": "坤为地", "generation_type": "八纯"},
        "100000": {"name": "地雷复", "generation_type": "一世"},
        "010000": {"name": "地泽临", "generation_type": "二世"},
        "111000": {"name": "地天泰", "generation_type": "三世"},
        "111001": {"name": "雷天大壮", "generation_type": "四世"},
        "111011": {"name": "泽天夬", "generation_type": "五世"},
        "111010": {"name": "水天需", "generation_type": "游魂"},
        "000010": {"name": "水地比", "generation_type": "归魂"}
    }},
    #... 其他六宫 (震巽坎离艮兑) 定义类似
}
# 简化的八宫，实际应用需要补全所有64卦的归属
# 震宫 (木): 震、豫、解、恒、升、井、大过、随
# 巽宫 (木): 巽、小畜、家人、益、无妄、噬嗑、颐、蛊
# 坎宫 (水): 坎、节、屯、既济、革、丰、明夷、师
# 离宫 (火): 离、旅、鼎、未济、蒙、涣、讼、同人
# 艮宫 (土): 艮、贲、大畜、损、睽、履、中孚、渐
# 兑宫 (金): 兑、困、萃、咸、蹇、谦、小过、归妹

# 纳甲规则 (参照表3)
# (天干, 地支) 顺序：初爻到上爻
NAJIA_RULES = {
    '乾': [('甲', '子'), ('甲', '寅'), ('甲', '辰'), ('壬', '午'), ('壬', '申'), ('壬', '戌')],
    '坤': [('乙', '未'), ('乙', '巳'), ('乙', '卯'), ('癸', '丑'), ('癸', '亥'), ('癸', '酉')],
    '震': [('庚', '子'), ('庚', '寅'), ('庚', '辰'), ('庚', '午'), ('庚', '申'), ('庚', '戌')],
    '巽': [('辛', '丑'), ('辛', '亥'), ('辛', '酉'), ('辛', '未'), ('辛', '巳'), ('辛', '卯')],
    '坎': [('戊', '寅'), ('戊', '辰'), ('戊', '午'), ('戊', '申'), ('戊', '戌'), ('戊', '子')],
    '离': [('己', '卯'), ('己', '丑'), ('己', '亥'), ('己', '酉'), ('己', '未'), ('己', '巳')],
    '艮': [('丙', '辰'), ('丙', '午'), ('丙', '申'), ('丙', '戌'), ('丙', '子'), ('丙', '寅')],
    '兑': [('丁', '巳'), ('丁', '卯'), ('丁', '丑'), ('丁', '亥'), ('丁', '酉'), ('丁', '未')],
}

# 世应规则 (参照表4)
# 爻位从1 (初爻) 到 6 (上爻)
SHI_YING_RULES = {
    "八纯": {"shi": 6, "ying": 3},
    "一世": {"shi": 1, "ying": 4},
    "二世": {"shi": 2, "ying": 5},
    "三世": {"shi": 3, "ying": 6},
    "四世": {"shi": 4, "ying": 1},
    "五世": {"shi": 5, "ying": 2},
    "游魂": {"shi": 4, "ying": 1}, # 京房八宫游魂卦世在四爻，应在初爻
    "归魂": {"shi": 3, "ying": 6}, # 京房八宫归魂卦世在三爻，应在上爻
}

# 六亲关系 (参照表5)
LIUQIN_RELATIONSHIPS = {
    ('木', '木'): '兄弟', ('木', '火'): '子孙', ('木', '土'): '妻财', ('木', '金'): '官鬼', ('木', '水'): '父母',
    ('火', '火'): '兄弟', ('火', '土'): '子孙', ('火', '金'): '妻财', ('火', '水'): '官鬼', ('火', '木'): '父母',
    ('土', '土'): '兄弟', ('土', '金'): '子孙', ('土', '水'): '妻财', ('土', '木'): '官鬼', ('土', '火'): '父母',
    ('金', '金'): '兄弟', ('金', '水'): '子孙', ('金', '木'): '妻财', ('金', '火'): '官鬼', ('金', '土'): '父母',
    ('水', '水'): '兄弟', ('水', '木'): '子孙', ('水', '火'): '妻财', ('水', '土'): '官鬼', ('水', '金'): '父母',
}

# 六神规则 (参照表6)
LIUSHOU_RULES = {
    '甲': ['青龙', '朱雀', '勾陈', '螣蛇', '白虎', '玄武'], '乙': ['青龙', '朱雀', '勾陈', '螣蛇', '白虎', '玄武'],
    '丙': ['朱雀', '勾陈', '螣蛇', '白虎', '玄武', '青龙'], '丁': ['朱雀', '勾陈', '螣蛇', '白虎', '玄武', '青龙'],
    '戊': ['勾陈', '螣蛇', '白虎', '玄武', '青龙', '朱雀'], '己': ['勾陈', '螣蛇', '白虎', '玄武', '青龙', '朱雀'], # 按[6]戊己同
    '庚': ['白虎', '玄武', '青龙', '朱雀', '勾陈', '螣蛇'], '辛': ['白虎', '玄武', '青龙', '朱雀', '勾陈', '螣蛇'],
    '壬': ['玄武', '青龙', '朱雀', '勾陈', '螣蛇', '白虎'], '癸': ['玄武', '青龙', '朱雀', '勾陈', '螣蛇', '白虎'],
}

# --- 辅助函数 ---
def get_trigram_from_lines(lines_tuple):
    """根据三爻二进制获取八卦名"""
    for name, info in TRIGRAMS.items():
        if info['lines'] == lines_tuple:
            return name
    return None

def lines_to_binary_str(lines_tuple):
    """将爻的元组 (0,0,0,1,1,1) 转换为二进制字符串 '111000' (上卦在前)"""
    return "".join(map(str, lines_tuple[3:] + lines_tuple[:3]))


def yao_results_to_lines(yao_res):
    """将摇卦结果 (6,7,8,9) 转换为本卦爻象 (0/1) 和动爻位置 (0-5)"""
    ben_gua_lines =
    dong_yao_indices =
    for i, res in enumerate(yao_res):
        if res == 6: # 老阴，本卦为阴，动爻
            ben_gua_lines.append(0)
            dong_yao_indices.append(i)
        elif res == 7: # 少阳，本卦为阳，静爻
            ben_gua_lines.append(1)
        elif res == 8: # 少阴，本卦为阴，静爻
            ben_gua_lines.append(0)
        elif res == 9: # 老阳，本卦为阳，动爻
            ben_gua_lines.append(1)
            dong_yao_indices.append(i)
        else:
            raise ValueError(f"无效的摇卦结果: {res}")
    return tuple(ben_gua_lines), dong_yao_indices

def get_bian_gua_lines(ben_gua_lines_tuple, dong_yao_indices):
    """获取变卦爻象"""
    if not dong_yao_indices:
        return None
    bian_gua_list = list(ben_gua_lines_tuple)
    for index in dong_yao_indices:
        bian_gua_list[index] = 1 - bian_gua_list[index] # 0变1, 1变0
    return tuple(bian_gua_list)

# --- 核心逻辑函数 ---
def determine_palace_info(ben_gua_lines_tuple):
    """确定卦宫信息"""
    # 将爻的顺序调整为 上卦+下卦 (高位到低位) 用于匹配BA_GONG_PALACES的键
    # 例如 (初,二,三,四,五,上) -> (上,五,四,三,二,初) -> "上五四三二初"
    # BA_GONG_PALACES 的键是 (上,五,四) + (三,二,初)
    hex_key = "".join(map(str, ben_gua_lines_tuple[::-1])) # 反转后连接，例如 (0,0,0,1,1,1) -> "111000"
  
    for palace_name, palace_data in BA_GONG_PALACES.items():
        if hex_key in palace_data['hexagrams']:
            hex_info = palace_data['hexagrams'][hex_key]
            return {
                "palace_name": palace_name,
                "palace_element": palace_data['element'],
                "hexagram_name": hex_info['name'],
                "generation_type": hex_info['generation_type']
            }
    # 如果未在简化的BA_GONG_PALACES中找到，需要完整数据或算法生成
    # 此处为简化处理，实际应用中BA_GONG_PALACES应包含所有64卦
    # 或者实现京房八宫的爻变算法来动态确定
    # 爻变算法：
    # 1. 找到纯卦
    # 2. 逐爻变，与目标卦比较，确定世数
    # 3. 若非1-5世，则从5世卦变第四爻为游魂，再变内卦为归魂
    # 这是一个复杂过程，此处暂用查表法（假设BA_GONG_PALACES已完备）
    raise ValueError(f"未能在八宫数据中找到卦象: {hex_key}. 请确保BA_GONG_PALACES数据完整。")


def assign_na_jia(ben_gua_lines_tuple, palace_info_result):
    """为六爻分配纳甲干支"""
    # 1. 确定内外卦的纯卦形式
    # ben_gua_lines_tuple 是 (初,二,三,四,五,上)
    inner_trigram_lines = ben_gua_lines_tuple[0:3]
    outer_trigram_lines = ben_gua_lines_tuple[3:6]

    inner_trigram_name = get_trigram_from_lines(inner_trigram_lines)
    outer_trigram_name = get_trigram_from_lines(outer_trigram_lines)

    if not inner_trigram_name or not outer_trigram_name:
        raise ValueError("无法识别内外卦")

    # 2. 根据内外卦的纯卦形式，从NAJIA_RULES获取其纳甲
    # 注意：NAJIA_RULES中的干支是针对纯卦的六个爻的
    # 对于组合卦，内卦取其纯卦的前三爻纳甲，外卦取其纯卦的后三爻纳甲
  
    na_jia_lines =
    # 内卦 (初、二、三爻)
    inner_najia_rules = NAJIA_RULES[inner_trigram_name]
    for i in range(3):
        na_jia_lines.append(inner_najia_rules[i])
  
    # 外卦 (四、五、上爻)
    outer_najia_rules = NAJIA_RULES[outer_trigram_name]
    for i in range(3, 6):
        na_jia_lines.append(outer_najia_rules[i])
      
    return na_jia_lines


def locate_shi_ying(generation_type):
    """确定世应爻位置"""
    if generation_type in SHI_YING_RULES:
        return SHI_YING_RULES[generation_type]
    raise ValueError(f"未知的世序类型: {generation_type}")

def assign_liu_qin(na_jia_assigned_lines, palace_element):
    """分配六亲"""
    liu_qin_lines =
    for _, dizhi in na_jia_assigned_lines:
        yao_element = DIZHI_INFO[dizhi]['element']
        relation_key = (palace_element, yao_element) # 注意顺序：(宫五行, 爻五行)
      
        # 调整为 (爻五行, 宫五行) 来匹配 LIUQIN_RELATIONSHIPS 的生克逻辑
        # 例如：爻木，宫金。关系是金克木（官鬼克我），所以爻是“妻财”（我克者）相对于宫。
        # 不对，LIUQIN_RELATIONSHIPS 的键应该是 (卦宫五行, 爻支五行)
        # 生我者为父母：爻生宫 -> 父母
        # 我生者为子孙：宫生爻 -> 子孙
      
        # 重新梳理六亲逻辑：
        # 爻五行 生 宫五行 => 父母 (爻是父母)
        # 宫五行 生 爻五行 => 子孙 (爻是子孙)
        # 爻五行 同 宫五行 => 兄弟 (爻是兄弟)
        # 爻五行 克 宫五行 => 妻财 (爻是妻财)
        # 宫五行 克 爻五行 => 官鬼 (爻是官鬼)

        # 使用标准的五行生克判断
        if yao_element == palace_element:
            liu_qin = "兄弟"
        # 宫生爻
        elif (palace_element == '木' and yao_element == '火') or \
             (palace_element == '火' and yao_element == '土') or \
             (palace_element == '土' and yao_element == '金') or \
             (palace_element == '金' and yao_element == '水') or \
             (palace_element == '水' and yao_element == '木'):
            liu_qin = "子孙"
        # 爻生宫
        elif (yao_element == '木' and palace_element == '火') or \
             (yao_element == '火' and palace_element == '土') or \
             (yao_element == '土' and palace_element == '金') or \
             (yao_element == '金' and palace_element == '水') or \
             (yao_element == '水' and palace_element == '木'):
            liu_qin = "父母"
        # 宫克爻
        elif (palace_element == '木' and yao_element == '土') or \
             (palace_element == '火' and yao_element == '金') or \
             (palace_element == '土' and yao_element == '水') or \
             (palace_element == '金' and yao_element == '木') or \
             (palace_element == '水' and yao_element == '火'):
            liu_qin = "官鬼" # 爻被宫克
        # 爻克宫
        elif (yao_element == '木' and palace_element == '土') or \
             (yao_element == '火' and palace_element == '金') or \
             (yao_element == '土' and palace_element == '水') or \
             (yao_element == '金' and palace_element == '木') or \
             (yao_element == '水' and palace_element == '火'):
            liu_qin = "妻财" # 爻克宫
        else:
            liu_qin = "错误" # 不应发生
        liu_qin_lines.append(liu_qin)
    return liu_qin_lines


def assign_liu_shou(day_tiangan_char):
    """分配六神"""
    if day_tiangan_char in LIUSHOU_RULES:
        return LIUSHOU_RULES[day_tiangan_char]
    raise ValueError(f"无效的日天干: {day_tiangan_char}")

# --- 主装卦函数 ---
def zhuang_gua(yao_results_list, day_tiangan_char):
    """
    进行完整的装卦过程
    yao_results_list: 六次摇卦结果列表, e.g.,  (初爻在前)
    day_tiangan_char: 当日天干字符, e.g., '甲'
    """
    if len(yao_results_list)!= 6:
        raise ValueError("摇卦结果必须是6个爻")
    if day_tiangan_char not in TIANGAN:
        raise ValueError(f"无效的日天干: {day_tiangan_char}")

    ben_gua_lines, dong_yao_indices = yao_results_to_lines(yao_results_list)
  
    # 1. 确定卦宫信息
    # 注意：palace_info中的卦名是基于标准64卦名，可能与BA_GONG_PALACES中的略有差异（如“乾为天”）
    # ben_gua_lines是 (初,二,三,四,五,上)
    palace_info = determine_palace_info(ben_gua_lines)

    # 2. 纳甲
    na_jia_assigned = assign_na_jia(ben_gua_lines, palace_info)

    # 3. 世应
    shi_ying_pos = locate_shi_ying(palace_info['generation_type'])

    # 4. 六亲
    liu_qin_assigned = assign_liu_qin(na_jia_assigned, palace_info['palace_element'])

    # 5. 六神
    liu_shou_assigned = assign_liu_shou(day_tiangan_char)

    # 6. 变卦 (如果存在动爻)
    bian_gua_info = None
    if dong_yao_indices:
        bian_gua_lines_tuple = get_bian_gua_lines(ben_gua_lines, dong_yao_indices)
        # 对变卦也可以进行完整的装卦，但通常只关心其卦象和爻辞
        # 此处简化，只获取变卦卦名和爻象
        bian_palace_info = determine_palace_info(bian_gua_lines_tuple) # 获取变卦名
        bian_gua_info = {
            "lines_tuple": bian_gua_lines_tuple,
            "hex_name": bian_palace_info['hexagram_name'], # 使用palace_info获取标准卦名
            "lines_char": [('—' if y == 1 else '--') for y in bian_gua_lines_tuple]
        }

    # 组织结果
    result = {
        "ben_gua": {
            "lines_tuple": ben_gua_lines,
            "hex_name": palace_info['hexagram_name'],
            "lines_char": [('—' if y == 1 else '--') for y in ben_gua_lines],
            "palace": palace_info['palace_name'],
            "palace_element": palace_info['palace_element'],
            "generation_type": palace_info['generation_type'],
            "dong_yao_indices": dong_yao_indices, # 0-indexed
            "yaos":
        },
        "bian_gua": bian_gua_info
    }

    yao_labels = ["初爻", "二爻", "三爻", "四爻", "五爻", "上爻"]
    for i in range(6):
        yao_data = {
            "label": yao_labels[i],
            "line_char": ('●' if ben_gua_lines[i] == 1 else 'X') if i in dong_yao_indices else ('—' if ben_gua_lines[i] == 1 else '--'),
            "tiangan": na_jia_assigned[i],
            "dizhi": na_jia_assigned[i],
            "dizhi_element": DIZHI_INFO[na_jia_assigned[i]]['element'],
            "liu_qin": liu_qin_assigned[i],
            "liu_shou": liu_shou_assigned[i],
            "is_shi": (i + 1) == shi_ying_pos['shi'],
            "is_ying": (i + 1) == shi_ying_pos['ying'],
            "is_dong": i in dong_yao_indices
        }
        result["ben_gua"]["yaos"].append(yao_data)
      
    return result

# --- 输出显示 ---
def display_gua_info(gua_data):
    """以可读格式显示装卦结果"""
    ben = gua_data["ben_gua"]
    print(f"本卦: {ben['hex_name']} ({''.join(ben['lines_char'])})")
    print(f"所属卦宫: {ben['palace']} ({ben['palace_element']}宫)")
    print(f"世序: {ben['generation_type']}")
    print("-" * 30)
    for i in range(5, -1, -1): # 从上爻开始打印
        yao = ben["yaos"][i]
        shi_ying_mark = ""
        if yao["is_shi"]: shi_ying_mark = " (世)"
        if yao["is_ying"]: shi_ying_mark = " (应)"
      
        line_display = yao["line_char"]
      
        print(f"{yao['label']}: {line_display}  {yao['tiangan']}{yao['dizhi']}({yao['dizhi_element']})  {yao['liu_qin']}  {yao['liu_shou']}{shi_ying_mark}")
  
    if gua_data["bian_gua"]:
        bian = gua_data["bian_gua"]
        print("-" * 30)
        print(f"变卦: {bian['hex_name']} ({''.join(bian['lines_char'])})")

```

**代码说明:**

* **数据定义:** 包含了天干、地支、五行、八卦、六十四卦名（部分）、八宫信息、纳甲规则、世应规则、六亲关系和六神规则。这些数据结构是算法的基础。`BA_GONG_PALACES` 和 `HEXAGRAM_NAMES` 在示例中是简化的，实际应用中需要包含所有64卦的完整信息。确定卦宫的 `determine_palace_info` 函数目前依赖于 `BA_GONG_PALACES` 查表，若表格不全，则会报错；一个更鲁棒的实现会包含京房八宫的爻变算法来动态确定一个卦的宫位和世序。
* **辅助函数:**
  * `get_trigram_from_lines`: 从三爻二进制得到八卦名。
  * `yao_results_to_lines`: 将摇钱结果（如6,7,8,9）转换为本卦的二进制爻象（0为阴，1为阳）和动爻的索引。
  * `get_bian_gua_lines`: 根据本卦和动爻生成变卦的爻象。
* **核心逻辑函数:**
  * `determine_palace_info`: 根据本卦爻象查找其所属卦宫、五行、卦名及世序。
  * `assign_na_jia`: 为本卦的六爻分配天干和地支。它首先确定卦的内外（上下）两个三爻经卦，然后根据这两个经卦的纯卦形式，从 `NAJIA_RULES`中分别取其对应爻位的纳甲。
  * `locate_shi_ying`: 根据卦的世序确定世爻和应爻的位置。
  * `assign_liu_qin`: 根据每爻的地支五行和卦宫五行的生克关系，为每爻安上六亲。
  * `assign_liu_shou`: 根据起卦日的日干，为六爻分配六神。
* **主装卦函数 (`zhuang_gua`):** 这是总调度函数。它接收摇卦结果和日干，依次调用其他核心函数完成整个装卦过程，并组织成一个结构化的字典返回。
* **输出显示 (`display_gua_info`):** 将装卦结果以易于阅读的格式打印出来。

### D. 使用示例与输出

假设某日为甲子日，摇卦得到的结果从初爻到上爻依次为：9 (老阳), 7 (少阳), 8 (少阴), 6 (老阴), 7 (少阳), 7 (少阳)。

**Python**

```python
# 示例：
# 假设起卦结果 (初爻到上爻): 
# 假设当日天干: '甲'

# 补全 BA_GONG_PALACES 和 HEXAGRAM_NAMES 才能完整运行
# 例如，为 乾宫 添加 天风姤 (011111) 等
# 此处假设 BA_GONG_PALACES 和 HEXAGRAM_NAMES 已有 '天风姤' (011111) 的定义：
# 在 BA_GONG_PALACES['乾']['hexagrams'] 中加入:
# "011111": {"name": "天风姤", "generation_type": "一世"},
# 在 HEXAGRAM_NAMES 中加入:
# "011111": "天风姤", 
# 变卦为 火风鼎 (011101)
# "011101": "火风鼎",
# BA_GONG_PALACES['离']['hexagrams'] (假设离为火)
# "011101": {"name": "火风鼎", "generation_type": "某世"}, # 需要确定鼎卦在离宫的世序

# 示例：乾宫一世卦 天风姤
# 摇卦结果：初爻动，其他静爻。假设初爻为9，其余为7或8，使得本卦为天风姤。
# 天风姤 (乾上巽下): 下卦巽 (110), 上卦乾 (111) -> (0,1,1,1,1,1) (初爻在左)
# 对应摇卦结果:  (初爻为9，变成0，即巽卦初爻)
yao_input =  # 得到 天风姤，初爻动
day_stem = '甲'

# 为了能运行，需要确保 BA_GONG_PALACES['乾']['hexagrams'] 中有 "011111" (天风姤)
# 变卦是 火风鼎 (011101) -> 巽下离上
# 需要确保 BA_GONG_PALACES 某个宫 (如离宫) 包含 火风鼎 "011101"
# 假设已补全数据：
if "011111" not in BA_GONG_PALACES['乾']['hexagrams']:
    BA_GONG_PALACES['乾']['hexagrams']["011111"] = {"name": "天风姤", "generation_type": "一世"}
if "011101" not in HEXAGRAM_NAMES: # 假设火风鼎在离宫，是二世卦
     HEXAGRAM_NAMES["011101"] = "火风鼎"
     if '离' not in BA_GONG_PALACES: # 假设离宫数据
         BA_GONG_PALACES['离'] = {'head_trigram': '离', 'element': '火', 'hexagrams': {
             "101101": {"name": "离为火", "generation_type": "八纯"},
             "001101": {"name": "火山旅", "generation_type": "一世"},
             "101101": {"name": "火风鼎", "generation_type": "二世"} # 假设
         }}
     elif "011101" not in BA_GONG_PALACES['离']['hexagrams']:
          BA_GONG_PALACES['离']['hexagrams']["011101"] = {"name": "火风鼎", "generation_type": "二世"}


try:
    gua_result = zhuang_gua(yao_input, day_stem)
    display_gua_info(gua_result)
except ValueError as e:
    print(f"发生错误: {e}")
    print("请确保 BA_GONG_PALACES 和 HEXAGRAM_NAMES 数据已针对此卦例补全。")

```

**预期输出 (以天风姤，甲日为例):**

```
本卦: 天风姤 (— — — — — ●)
所属卦宫: 乾 (金宫)
世序: 一世
------------------------------
上爻: —  壬戌(土)  父母  玄武
五爻: —  壬申(金)  兄弟  白虎
四爻: —  壬午(火)  官鬼  螣蛇
三爻: —  甲辰(土)  父母  勾陈 (应)
二爻: —  甲寅(木)  妻财  朱雀
初爻: ●  甲子(水)  子孙  青龙 (世)
------------------------------
变卦: 火风鼎 (— — — — — —)
```

*(注意：实际输出的爻象字符可能因终端显示而异，● 代表动阳爻，X 代表动阴爻。变卦的爻象是根据动爻变化后的结果。六亲是根据天风姤属乾金宫，与各爻地支五行关系确定。六神按甲日起青龙。世应根据一世卦规则。)*

此Python脚本提供了一个将六爻装卦和纳甲过程自动化的框架。通过精确定义数据结构和算法逻辑，它能够模拟传统的手动装卦步骤，为学习和应用六爻预测法提供便利。

## IV. 结论

### A. 装卦与纳甲过程回顾

六爻预测中的装卦与纳甲，是一个将原始卦象转化为蕴含丰富信息的预测模型的关键步骤。此过程虽然规则繁复，但具有高度的系统性和逻辑性。从获取本卦、记录时间，到确定卦宫、纳甲配干支，再到安世应、六亲、六神，每一步都依据既定的易学原理和规则进行。卦宫揭示了卦的根本五行属性和在八宫体系中的演化位置；纳甲为爻赋予了干支，从而引入了五行生克的动态分析基础；世应爻确立了占断的自我与对象；六亲则将爻的含义与具体人事关联；六神则从日辰天干引入了额外的性质描述。这些元素的有机结合，共同构建了一个多层次的符号系统，为后续的吉凶判断和事态分析奠定了基础。

### B. 计算工具在研究古代占卜中的效用

将如六爻装卦这样的复杂传统规则体系通过计算机编程（如本报告中的Python脚本）加以实现，展现了现代技术在研究和应用古代智慧方面的潜力。自动化工具能够显著提高装卦的准确性和效率，尤其对于初学者，可以避免因记忆不牢或计算疏忽导致的错误，使他们能更快地将精力投入到卦象解读这一更核心的环节 ^2^。

更深一层来看，这类计算工具的开发过程本身，也是对传统知识体系进行结构化梳理和逻辑验证的过程。它迫使研究者将模糊的或经验性的规则明确化、条理化，从而深化对该体系内在机制的理解。此外，程序化的实现使得这些古老的知识能够以一种新的、可执行的形态得以保存和传播。这不仅有助于降低学习门槛，让更多人接触和了解传统文化，也为这些古老占卜术的传承和发展开辟了新的途径，使其在数字时代焕发新的生命力。通过编码实现，复杂的规则系统变得更加透明和易于验证，促进了学术研究的精确性和可重复性。
